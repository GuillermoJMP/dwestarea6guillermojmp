<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Viveros Acme - Mensajes</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css" />
</head>
<body data-page="mensajes">
    <!-- Offcanvas Menú Lateral -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasMenu" aria-labelledby="offcanvasMenuLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasMenuLabel">Menú</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="list-group">
                <li class="list-group-item"><a th:href="@{/inicio}">Inicio</a></li>
                <li class="list-group-item"><a th:href="@{/plantas}">Gestión de Plantas</a></li>
                <li class="list-group-item"><a th:href="@{/ejemplares}">Gestión de Ejemplares</a></li>
                <li class="list-group-item"><a th:href="@{/mensajes}">Gestión de Mensajes</a></li>
                <li class="list-group-item"><a th:href="@{/persona}">Gestión de Personas</a></li>
            </ul>
        </div>
    </div>

    <!-- Encabezado -->
    <header class="container-fluid bg-light p-3 d-flex justify-content-between align-items-center">
        <button class="btn btn-success" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu" aria-controls="offcanvasMenu" aria-label="Abrir menú">
            <span class="navbar-toggler-icon"></span> Menú
        </button>
        <h1 class="m-0 text-uppercase">Viveros Acme</h1>
        <div class="dropdown">
            <a href="#" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="user.png" alt="Usuario" class="rounded-circle user-icon" />
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                <li><a class="dropdown-item" th:href="@{/perfil}">Perfil</a></li>
                <li><a class="dropdown-item" th:href="@{/login}">Cerrar Sesión</a></li>
            </ul>
        </div>
    </header>

    <!-- Contenido Principal: Mensajes -->
    <main class="container mt-4">
        <h2>Gestión de Mensajes</h2>

        <!-- Formulario de Búsqueda -->
        <section class="mb-4">
            <h3>Buscar Mensajes</h3>
            <form th:action="@{/mensajes/filtrar}" method="get">
                <div class="row g-2">
                    <div class="col-md-4">
                        <label for="usuario" class="form-label">Usuario</label>
                        <input type="text" id="usuario" name="usuario" class="form-control" placeholder="Filtrar por Usuario" />
                    </div>
                    <div class="col-md-3">
                        <label for="fechaInicio" class="form-label">Fecha Inicio</label>
                        <input type="date" id="fechaInicio" name="fechaInicio" class="form-control" />
                    </div>
                    <div class="col-md-3">
                        <label for="fechaFin" class="form-label">Fecha Fin</label>
                        <input type="date" id="fechaFin" name="fechaFin" class="form-control" />
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">Filtrar</button>
                    </div>
                </div>
            </form>
        </section>

        <!-- Tabla de Listado de Mensajes -->
        <section>
            <h3>Listado de Mensajes</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Usuario</th>
                            <th>Mensaje</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="mensaje : ${mensajes}">
                            <td th:text="${#dates.format(mensaje.fechaHora, 'dd/MM/yyyy HH:mm')}"></td>
                            <td th:text="${mensaje.persona != null ? mensaje.persona.nombre : 'Desconocido'}"></td>
                            <td th:text="${mensaje.mensaje}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Formulario para Crear Mensaje -->
        <section>
            <h3>Crear Anotación</h3>
            <form th:action="@{/mensajes/crear}" method="post">
                <div class="mb-3">
                    <label for="anotacion" class="form-label">Anotación</label>
                    <textarea class="form-control" id="anotacion" name="anotacion" rows="3" placeholder="Escriba su anotación"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Crear Mensaje</button>
            </form>
        </section>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
